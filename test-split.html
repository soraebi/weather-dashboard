<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API分割テスト</title>
</head>
<body>
    <h1>Weather API 分割テスト</h1>
    <div id="test-results"></div>

    <!-- 分割されたAPIファイルを読み込み -->
    <script src="src/api/config.js"></script>
    <script src="src/api/cache-manager.js"></script>
    <script src="src/api/japanese-cities.js"></script>
    <script src="src/api/geocoding-api.js"></script>
    <script src="src/api/weather-data-api.js"></script>
    <script src="src/api/geolocation-api.js"></script>
    <script src="src/api/weather-api.js"></script>

    <script>
        function log(message, isError = false) {
            const div = document.getElementById('test-results');
            const p = document.createElement('p');
            p.style.color = isError ? 'red' : 'green';
            p.textContent = message;
            div.appendChild(p);
            console.log(message);
        }

        // テスト実行
        try {
            log('🚀 Starting API module tests...');

            // 1. 各モジュールの存在チェック
            const modules = [
                'WeatherAPIConfig',
                'CacheManager',
                'JapaneseCities', 
                'GeocodingAPI',
                'WeatherDataAPI',
                'GeolocationAPI',
                'OpenMeteoAPI'
            ];

            modules.forEach(module => {
                if (window[module]) {
                    log(`✅ ${module} loaded successfully`);
                } else {
                    log(`❌ ${module} not found`, true);
                }
            });

            // 2. OpenMeteoAPI インスタンス作成テスト
            log('📦 Testing OpenMeteoAPI instantiation...');
            const api = new OpenMeteoAPI();
            log('✅ OpenMeteoAPI instance created successfully');

            // 3. Health check テスト
            log('🔍 Running health check...');
            const health = api.healthCheck();
            log(`✅ Health check passed: ${Object.values(health).filter(v => v === true).length}/6 modules healthy`);

            // 4. 日本の都市データテスト
            log('🏙️ Testing Japanese cities data...');
            const cities = api.getJapaneseCities();
            log(`✅ Loaded ${cities.length} Japanese cities`);
            
            // 東京の検索テスト
            const tokyo = JapaneseCities.findExactMatch('東京');
            if (tokyo) {
                log(`✅ Tokyo found: ${tokyo.name} (${tokyo.latitude}, ${tokyo.longitude})`);
            } else {
                log('❌ Tokyo not found', true);
            }

            // 5. 設定値テスト
            log('⚙️ Testing configuration...');
            log(`✅ Base URL: ${WeatherAPIConfig.BASE_URL}`);
            log(`✅ Cache expiry: ${WeatherAPIConfig.CACHE_EXPIRY / 1000 / 60} minutes`);

            // 6. キャッシュマネージャーテスト
            log('💾 Testing cache manager...');
            const cacheManager = new CacheManager();
            cacheManager.set('test-key', 'test-value');
            const cached = cacheManager.get('test-key');
            if (cached === 'test-value') {
                log('✅ Cache manager working correctly');
            } else {
                log('❌ Cache manager failed', true);
            }

            log('🎉 All tests completed successfully!');
            
        } catch (error) {
            log(`❌ Test failed: ${error.message}`, true);
            console.error('Test error:', error);
        }
    </script>
</body>
</html>
