<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIåˆ†å‰²ãƒ†ã‚¹ãƒˆ</title>
</head>
<body>
    <h1>Weather API åˆ†å‰²ãƒ†ã‚¹ãƒˆ</h1>
    <div id="test-results"></div>

    <!-- åˆ†å‰²ã•ã‚ŒãŸAPIãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="src/api/config.js"></script>
    <script src="src/api/cache-manager.js"></script>
    <script src="src/api/japanese-cities.js"></script>
    <script src="src/api/geocoding-api.js"></script>
    <script src="src/api/weather-data-api.js"></script>
    <script src="src/api/geolocation-api.js"></script>
    <script src="src/api/weather-api.js"></script>

    <script>
        function log(message, isError = false) {
            const div = document.getElementById('test-results');
            const p = document.createElement('p');
            p.style.color = isError ? 'red' : 'green';
            p.textContent = message;
            div.appendChild(p);
            console.log(message);
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        try {
            log('ğŸš€ Starting API module tests...');

            // 1. å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
            const modules = [
                'WeatherAPIConfig',
                'CacheManager',
                'JapaneseCities', 
                'GeocodingAPI',
                'WeatherDataAPI',
                'GeolocationAPI',
                'OpenMeteoAPI'
            ];

            modules.forEach(module => {
                if (window[module]) {
                    log(`âœ… ${module} loaded successfully`);
                } else {
                    log(`âŒ ${module} not found`, true);
                }
            });

            // 2. OpenMeteoAPI ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆãƒ†ã‚¹ãƒˆ
            log('ğŸ“¦ Testing OpenMeteoAPI instantiation...');
            const api = new OpenMeteoAPI();
            log('âœ… OpenMeteoAPI instance created successfully');

            // 3. Health check ãƒ†ã‚¹ãƒˆ
            log('ğŸ” Running health check...');
            const health = api.healthCheck();
            log(`âœ… Health check passed: ${Object.values(health).filter(v => v === true).length}/6 modules healthy`);

            // 4. æ—¥æœ¬ã®éƒ½å¸‚ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ
            log('ğŸ™ï¸ Testing Japanese cities data...');
            const cities = api.getJapaneseCities();
            log(`âœ… Loaded ${cities.length} Japanese cities`);
            
            // æ±äº¬ã®æ¤œç´¢ãƒ†ã‚¹ãƒˆ
            const tokyo = JapaneseCities.findExactMatch('æ±äº¬');
            if (tokyo) {
                log(`âœ… Tokyo found: ${tokyo.name} (${tokyo.latitude}, ${tokyo.longitude})`);
            } else {
                log('âŒ Tokyo not found', true);
            }

            // 5. è¨­å®šå€¤ãƒ†ã‚¹ãƒˆ
            log('âš™ï¸ Testing configuration...');
            log(`âœ… Base URL: ${WeatherAPIConfig.BASE_URL}`);
            log(`âœ… Cache expiry: ${WeatherAPIConfig.CACHE_EXPIRY / 1000 / 60} minutes`);

            // 6. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆ
            log('ğŸ’¾ Testing cache manager...');
            const cacheManager = new CacheManager();
            cacheManager.set('test-key', 'test-value');
            const cached = cacheManager.get('test-key');
            if (cached === 'test-value') {
                log('âœ… Cache manager working correctly');
            } else {
                log('âŒ Cache manager failed', true);
            }

            log('ğŸ‰ All tests completed successfully!');
            
        } catch (error) {
            log(`âŒ Test failed: ${error.message}`, true);
            console.error('Test error:', error);
        }
    </script>
</body>
</html>
